<div class="gl-list-container">
  <ax-card class="main-card">
    <mat-card-header ax-card-header>
      <div class="header-content">
        <ax-button variant="icon" (click)="goBack()" class="back-button">
          <ax-icon name="arrow_back"></ax-icon>
        </ax-button>
        <mat-card-title class="card-title">
          <ax-icon name="account_balance" class="title-icon"></ax-icon>
          {{ 'generalLedger.title' | translate }}
        </mat-card-title>
      </div>
    </mat-card-header>

    <div class="controls-section">
      @if (tableFilterable) {
        <div class="filter-controls">
          @if (showFilters()) {
            <ax-button
                    variant="flat"
                    color="primary"
                    [label]="getClearFiltersLabel()"
                    (click)="clearTableFilters()">
              <ax-icon name="clear"></ax-icon>
            </ax-button>
          }
          <ax-button
                  variant="flat"
                  color="primary"
                  [label]="showFilters() ? ('hideFilters' | translate) : ('showFilters' | translate)"
                  (click)="toggleFilters(); $event.stopPropagation()">
            <ax-icon [name]="showFilters() ? 'visibility_off' : 'visibility'"></ax-icon>
          </ax-button>
        </div>
      }
    </div>

    <div class="table-container">
      <!-- Custom cell templates defined outside ax-table for ViewChild access -->
      <ng-template #dateCell let-row let-column="column">
        {{ formatDate(row.date) }}
      </ng-template>

      <ng-template #typeCell let-row let-column="column">
        <span
                class="type-badge"
                [style.color]="getTypeColor(row.type)"
                [style.background-color]="getTypeBackgroundColor(row.type)">
          {{ getTypeLabel(row.type) }}
        </span>
      </ng-template>

      <ng-template #orderPoInvoiceCell let-row let-column="column">
        <span *ngIf="row.poNumber">{{ 'generalLedger.poPrefix' | translate }} {{ row.poNumber }}</span>
        <span *ngIf="row.orderNumber">{{ 'generalLedger.orderPrefix' | translate }} {{ row.orderNumber }}</span>
        <span *ngIf="!row.poNumber && !row.orderNumber">-</span>
        <span *ngIf="row.invoiceNumber"> / {{ row.invoiceNumber }}</span>
      </ng-template>

      <ng-template #quantityCell let-row let-column="column">
        {{ row.quantity }}
      </ng-template>

      <ng-template #debitCell let-row let-column="column">
        <span [class.debit-amount]="getDebitAmount(row) > 0">
          {{ getDebitAmount(row) > 0 ? (getDebitAmount(row) | currency) : '-' }}
        </span>
      </ng-template>

      <ng-template #creditCell let-row let-column="column">
        <span [class.credit-amount]="getCreditAmount(row) > 0">
          {{ getCreditAmount(row) > 0 ? (getCreditAmount(row) | currency) : '-' }}
        </span>
      </ng-template>

      <ng-template #actionsCell let-row let-column="column">
        <ax-button
                *ngIf="row.orderId || row.poId"
                variant="icon"
                color="primary"
                (click)="viewEntry(row); $event.stopPropagation()"
                [axTooltip]="'generalLedger.table.view' | translate">
          <ax-icon name="visibility"></ax-icon>
        </ax-button>
      </ng-template>

      <ax-table
          #axTable
          [dataSource]="glEntries() || []"
          [columns]="columns()"
          [filterable]="tableFilterable"
          [showFilter]="showFilterValue"
          [showSort]="true"
          [showPaginator]="true"
          [pageSize]="10"
          [selectionMode]="'none'">
      </ax-table>

      @if (glEntries() && glEntries().length === 0 && !isLoading()) {
        <div class="no-data">
          <ax-icon name="info" class="no-data-icon"></ax-icon>
          <p>{{ 'generalLedger.noEntries' | translate }}</p>
        </div>
      }

      @if (isLoading()) {
        <div class="loading">
          <ax-progress type="spinner" mode="indeterminate"></ax-progress>
          <p>{{ 'generalLedger.loading' | translate }}</p>
        </div>
      }
    </div>

    @if (glEntries() && glEntries().length > 0) {
      <div class="summary-section">
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalDebit' | translate }}</span>
          <span class="summary-value debit">{{ totalDebit | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalCredit' | translate }}</span>
          <span class="summary-value credit">{{ totalCredit | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalRevenue' | translate }}</span>
          <span class="summary-value credit">{{ totalRevenue | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalCost' | translate }}</span>
          <span class="summary-value debit">{{ totalCost | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalExpense' | translate }}</span>
          <span class="summary-value debit">{{ totalExpense | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalAccountsPayable' | translate }}</span>
          <span class="summary-value debit">{{ totalAccountsPayable | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.totalPayments' | translate }}</span>
          <span class="summary-value credit">{{ totalPayment | currency }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">{{ 'generalLedger.summary.netIncome' | translate }}</span>
          <span class="summary-value" [class.debit]="netIncome < 0" [class.credit]="netIncome >= 0">
            {{ netIncome | currency }}
          </span>
        </div>
      </div>
    }
  </ax-card>
</div>
