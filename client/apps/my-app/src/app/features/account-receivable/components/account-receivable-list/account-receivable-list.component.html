<div class="account-receivable-list-container">
  <ax-card class="main-card">
    <mat-card-header ax-card-header>
      <div class="header-content">
        <ax-button variant="icon" (click)="goBack()" class="back-button">
          <ax-icon name="arrow_back"></ax-icon>
        </ax-button>
        <mat-card-title class="card-title">
          <ax-icon name="account_balance_wallet" class="title-icon"></ax-icon>
          {{ 'accountsReceivable.title' | translate }}
        </mat-card-title>
      </div>
    </mat-card-header>

    <div class="controls-section">
      @if (tableFilterable) {
        <div class="filter-controls">
          @if (showFilters()) {
            <ax-button
                    variant="flat"
                    color="primary"
                    [label]="getClearFiltersLabel()"
                    (click)="clearTableFilters()">
              <ax-icon name="clear"></ax-icon>
            </ax-button>
          }
          <ax-button
                  variant="flat"
                  color="primary"
                  [label]="showFilters() ? ('hideFilters' | translate) : ('showFilters' | translate)"
                  (click)="toggleFilters(); $event.stopPropagation()">
            <ax-icon [name]="showFilters() ? 'visibility_off' : 'visibility'"></ax-icon>
          </ax-button>
        </div>
      }
    </div>

    <div class="table-container">
      <!-- Custom cell templates defined outside ax-table for ViewChild access -->
      <ng-template #customerCell let-row let-column="column">
        {{ getCustomerName(row.customerId) }}
      </ng-template>

      <ng-template #invoiceDateCell let-row let-column="column">
        {{ formatDate(row.invoiceDate) }}
      </ng-template>

      <ng-template #invoiceAmountCell let-row let-column="column">
        {{ row.total || 0 | currency }}
      </ng-template>

      <ng-template #paidAmountCell let-row let-column="column">
        {{ (row.jsonData?.paymentAmount || 0) | currency }}
      </ng-template>

      <ng-template #outstandingCell let-row let-column="column">
        <span [class.outstanding-positive]="calculateOutstandingAmount(row) > 0">
          {{ calculateOutstandingAmount(row) | currency }}
        </span>
      </ng-template>

      <ng-template #statusCell let-row let-column="column">
        <ax-chip [label]="getStatusLabel(row.status)" [customColor]="getStatusColor(row.status)"
                 [customBackgroundColor]="getStatusBackgroundColor(row.status)">
        </ax-chip>
      </ng-template>

      <ng-template #actionsCell let-row let-column="column">
        <ax-button
                variant="icon"
                color="primary"
                (click)="viewInvoice(row); $event.stopPropagation()"
                [axTooltip]="'view' | translate">
          <ax-icon name="visibility"></ax-icon>
        </ax-button>
      </ng-template>

      <ax-table
          #axTable
          [dataSource]="filteredOrders() || []"
          [columns]="columns()"
          [filterable]="tableFilterable"
          [showFilter]="showFilterValue"
          [showSort]="true"
          [showPaginator]="true"
          [pageSize]="10"
          [selectionMode]="'none'">
      </ax-table>

      @if (filteredOrders() && filteredOrders().length === 0 && !isLoading()) {
        <div class="no-data">
          <ax-icon name="info" class="no-data-icon"></ax-icon>
          <p>{{ 'accountsReceivable.noInvoices' | translate }}</p>
        </div>
      }

      @if (isLoading()) {
        <div class="loading">
          <ax-progress type="spinner" mode="indeterminate"></ax-progress>
          <p>{{ 'loadingData' | translate }}</p>
        </div>
      }
    </div>
  </ax-card>
</div>
