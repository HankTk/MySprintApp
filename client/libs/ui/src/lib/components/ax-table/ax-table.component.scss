.ax-table-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  overflow: visible !important;
  isolation: isolate; // Create new stacking context
}

.filter-row {
  background-color: var(--bg-table-header, #f5f5f5);
  overflow: visible !important;
  position: relative;
  z-index: 1; // Lower than popup
  
    .filter-header {
      overflow: visible !important;
      position: relative;
      padding: 4px 8px 2px 8px !important;
      vertical-align: middle;
      z-index: 1 !important;
    
    .filter-field-inline {
      width: 100%;
      height: 50px !important;
      
      ::ng-deep {
        .mat-mdc-form-field {
          width: 100%;
          height: 50px !important;
        }
        
        .mat-mdc-text-field-wrapper {
          padding-bottom: 0;
          height: 50px !important;
        }
        
        .mat-mdc-form-field-infix {
          padding-top: 0;
          padding-bottom: 0;
          min-height: 50px !important;
          height: 50px !important;
          display: flex;
          align-items: center;
        }
        
        .mat-mdc-form-field-subscript-wrapper {
          display: none;
        }
      }
    }
    
    .date-range-single-wrapper {
      position: relative;
      width: 100%;
      z-index: 99999 !important;
      overflow: visible !important;
      
      * {
        pointer-events: auto !important;
      }
    }
    
    .date-range-single {
      width: 100%;
      
      ::ng-deep {
        .mat-mdc-form-field {
          width: 100%;
        }
        
        input[readonly] {
          cursor: pointer;
        }
      }
    }
    
    .date-range-popup {
      position: fixed !important;
      z-index: 999999 !important;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.12);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      min-width: 400px;
      max-width: 500px;
      pointer-events: auto !important;
      overflow: visible !important;
      display: block !important;
      visibility: visible !important;
      transform: translateZ(0) !important; // Force into new compositing layer
      will-change: transform !important; // Hint browser to optimize
      // Position will be set by JavaScript
      
      .date-range-popup-content {
        padding: 16px;
        overflow: visible !important;
        position: relative;
        z-index: 999999 !important;
        
        .date-range-fields {
          display: flex;
          align-items: flex-start;
          gap: 8px;
          margin-bottom: 16px;
          
          .date-range-start,
          .date-range-end {
            flex: 1;
            min-width: 0;
          }
          
          .date-range-separator {
            flex-shrink: 0;
            padding: 0 4px;
            margin-top: 24px;
            color: rgba(0, 0, 0, 0.6);
            font-weight: 500;
          }
        }
        
        .date-range-actions {
          display: flex;
          justify-content: flex-end;
          align-items: center;
          gap: 8px;
          width: 100%;
          margin-top: 0;
        }
      }
    }
    
    ::ng-deep {
      // Ensure datepicker overlays are above everything
      .mat-datepicker-popup {
        z-index: 9999999 !important;
      }
      
      .cdk-overlay-container {
        z-index: 9999999 !important;
      }
      
      .cdk-overlay-pane {
        z-index: 9999999 !important;
      }
      
      .mat-datepicker-popup-container {
        z-index: 9999999 !important;
      }
      
      .mat-calendar {
        z-index: 9999999 !important;
      }
      
      // Ensure the popup itself is above table headers globally
      .date-range-popup {
        z-index: 999999 !important;
      }
    }
    
  }
}

.ax-table {
  width: 100%;
  overflow: visible !important;
  
  ::ng-deep {
    .mat-mdc-header-cell {
      background-color: var(--bg-table-header, #f5f5f5) !important;
      overflow: visible !important;
      position: relative;
      z-index: 1 !important;
      isolation: isolate; // Prevent creating stacking context that traps popup
    }
    
    .mat-mdc-cell {
      overflow: visible !important;
    }
    
    .mat-mdc-row {
      overflow: visible !important;
    }
  }
}

.selection-header,
.selection-cell {
  width: 48px;
  text-align: center;
}

.selectable-row {
  cursor: pointer;
  transition: background-color 0.2s;

  &:hover {
    background-color: rgba(0, 0, 0, 0.04);
  }
}

.selected-row {
  background-color: rgba(63, 81, 181, 0.1) !important;

  &:hover {
    background-color: rgba(63, 81, 181, 0.15) !important;
  }
}

// Overlay panel styles
::ng-deep {
  .date-range-overlay-panel {
    z-index: 999999 !important;
    pointer-events: auto !important;
    
    .cdk-overlay-pane {
      pointer-events: auto !important;
    }
    
    .date-range-popup {
      position: relative !important;
      z-index: 999999 !important;
      background: white !important;
      border: 1px solid rgba(0, 0, 0, 0.12) !important;
      border-radius: 4px !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
      min-width: 400px !important;
      max-width: 500px !important;
      pointer-events: auto !important;
      overflow: visible !important;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      
      .date-range-popup-content {
        padding: 16px !important;
        display: block !important;
        visibility: visible !important;
        
        .date-range-fields {
          display: flex !important;
          gap: 8px !important;
          margin-bottom: 16px !important;
          visibility: visible !important;
          
          mat-form-field {
            flex: 1 !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
          }
        }
        
        .date-range-actions {
          display: flex !important;
          justify-content: flex-end !important;
          align-items: center !important;
          gap: 8px !important;
          width: 100% !important;
          margin-top: 0 !important;
        }
      }
    }
  }
  
  .cdk-overlay-container {
    z-index: 9999999 !important;
  }
  
  .cdk-overlay-pane {
    pointer-events: auto !important;
  }
}

